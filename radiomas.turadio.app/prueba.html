<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Pragma" content="no-cache">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RADIO MAS 104.9 Tierra del Fuego</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />

  <!-- Icono y estilos -->
  <link rel="icon" href="logo.png" type="image/png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="all.min.css" />

  <!-- Librerías -->
  <script src="jquery-3.6.0.min.js"></script>
  <script type="module" src="pwa-install.bundle.js"></script>
  <script src="lunaradio-sincors.js"></script>
  <script src="https://kit.fontawesome.com/a2e0e6ad5b.js" crossorigin="anonymous"></script>

  <style>
    /* ===== TERMINAL CARD ===== */
    .card {
      padding: 1rem;
      overflow: hidden;
      border: 1px solid #c5c5c5;
      border-radius: 12px;
      background-color: #d9d9d92f;
      backdrop-filter: blur(8px);
      min-width: 200px;
      width: 95%;
      max-width: 600px;
      margin: 0 auto 20px;
      display: block;
    }
    .wrap { display:flex; flex-direction:column; gap:1rem; border:0.5px solid #525252; border-radius:8px; overflow:hidden; width:100%; box-sizing:border-box; }
    .terminal { display:flex; flex-direction:column; font-family: ui-monospace, Menlo, Consolas, "Courier New", monospace; }
    .head { display:flex; align-items:center; justify-content:space-between; min-height:40px; padding-inline:12px; background-color:#202425; border-top-left-radius:8px; border-top-right-radius:8px; }
    .title { display:flex; align-items:center; gap:8px; height:2.5rem; user-select:none; font-weight:600; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; color:#8e8e8e; }
    .copy_toggle { display:flex; align-items:center; justify-content:center; padding:0.25rem; border:0.65px solid #c1c2c5; margin-left:auto; border-radius:6px; background-color:#202425; color:#8e8e8e; cursor:pointer; }
    .body { display:flex; flex-direction:column; padding:1rem; line-height:19px; color:white; background-color:black; white-space:pre-wrap; word-break:break-word; border-bottom-left-radius:8px; border-bottom-right-radius:8px; }
    .pre { display:flex; flex-direction:row; align-items:center; white-space:pre; background-color:transparent; overflow:hidden; box-sizing:border-box; font-size:16px; }
    .cmd { height:19px; position:relative; display:flex; align-items:center; flex-direction:row; }
    .cmd::before { content: attr(data-cmd); display:block; white-space:pre-wrap; overflow:hidden; animation:typewriter 5s steps(60,end) forwards; width:0; }
    .cmd::after { content:""; display:block; height:100%; border-right:0.15em solid #e34ba9; animation:cursor 0.5s step-end infinite alternate, blinking 0.5s infinite; }
    @keyframes blinking { 20%,80%{ transform:scaleY(1);} 50%{ transform:scaleY(0);} }
    @keyframes cursor { 50%{ border-right-color: transparent; } }
    @keyframes typewriter { from{width:0;} to{width:100%;} }

    /* ===== RADIO Y REDES ===== */
    .radio-container { width:95%; max-width:600px; margin:20px auto; }
    .action-grid { width:95%; max-width:600px; margin:20px auto; display:flex; justify-content:center; flex-wrap:wrap; gap:10px; }
    .social-minimal { display:flex; justify-content:center; flex-wrap:wrap; gap:10px; }
    .social-minimal a { flex:1 0 40px; max-width:50px; text-align:center; }
    .powered { width:95%; max-width:600px; margin:20px auto; text-align:center; font-size:14px; color:#ccc; }

    /* ===== CHAT WIDGET ===== */
    #chat-widget { position:fixed; right:20px; bottom:20px; width:320px; max-width:calc(100% - 40px); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,0.4); backdrop-filter:blur(8px); background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.06); overflow:hidden; z-index:1000; display:flex; flex-direction:column; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:#eef0f2; }
    #chat-header { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:rgba(0,0,0,0.35); border-bottom:1px solid rgba(255,255,255,0.03); gap:8px; }
    #chat-header .title { font-weight:600; font-size:14px; color:#fff; display:flex; align-items:center; gap:8px; }
    #chat-messages { height:260px; overflow-y:auto; padding:10px; display:flex; flex-direction:column; gap:8px; scroll-behavior:smooth; background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01)); }
    .msg { max-width:80%; padding:8px 10px; border-radius:10px; font-size:13px; line-height:1.15; box-shadow:0 2px 6px rgba(0,0,0,0.25); word-break:break-word; }
    .msg.me { background: rgba(255,255,255,0.06); align-self:flex-end; color:#fff; }
    .msg.other { background: rgba(255,255,255,0.03); align-self:flex-start; color:#fff; }
    .msg.typing { opacity:0.85; font-style:italic; }
    .msg .meta { display:block; font-size:11px; color:#cfcfcf; margin-top:6px; opacity:0.9; }
    #chat-input { display:flex; gap:8px; padding:10px; align-items:center; border-top:1px solid rgba(255,255,255,0.03); background: rgba(0,0,0,0.25); }
    #chat-input input[type="text"] { flex:1; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background: rgba(0,0,0,0.15); color:#fff; outline:none; font-size:13px; }
    #chat-input button { background: linear-gradient(180deg,#ff3b3b,#d40000); border:none; color:white; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:600; }
    #chat-quick { padding:8px 10px; border-top:1px solid rgba(255,255,255,0.03); display:flex; gap:6px; flex-wrap:wrap; background:rgba(0,0,0,0.12); }

    #chat-toggle-btn { position:fixed; right:20px; bottom:20px; width:56px; height:56px; border-radius:50%; background:linear-gradient(180deg,#ff3b3b,#d40000); display:flex; align-items:center; justify-content:center; box-shadow:0 8px 24px rgba(212,0,0,0.25); z-index:999; cursor:pointer; color:white; border:none; outline:none; font-size:22px; }

    .chat-open #chat-toggle-btn { display:none; }
    .chat-hidden #chat-widget { display:none; }
    a.chat-link { color:#ffd; text-decoration:underline; }

    /* ===== RESPONSIVE ===== */
    @media screen and (max-width:480px) {
      body { font-size: 15px; margin: 0; padding: 0; }
      .card, .radio-container, .action-grid, .powered { width: 100%; padding: 0 10px; box-sizing: border-box; }
      .social-minimal a { flex:1 0 20%; max-width:50px; }
      #chat-widget { width: 100%; right: 0; left: 0; bottom: 0; border-radius: 12px 12px 0 0; max-height: 90vh; }
      #chat-messages { height: 200px; }
      #chat-input input[type="text"] { font-size: 14px; }
      #chat-toggle-btn { right: 15px; bottom: 15px; width: 50px; height: 50px; font-size: 20px; }
      .msg { font-size: 14px; padding: 6px 8px; }
      .msg .meta { font-size: 10px; }
      .powered { font-size: 13px; padding-bottom: 20px; }
    }
  </style>
</head>

<body>
  <!-- Fondos -->
  <div id="bg1" class="bg-fade"></div>
  <div id="bg2" class="bg-fade" style="opacity:0;"></div>

  <main>
    <!-- Reproductor -->
    <div class="radio-container">
      <div class="glass-frame"></div>
      <div id="lunaradio"></div>
    </div>

    <!-- Redes sociales -->
    <div class="action-grid">
      <div class="social-minimal">
        <a href="https://www.facebook.com/radiomas104.9" target="_blank" rel="noopener"><div class="sm-btn sm-facebook"><i class="fab fa-facebook-f"></i></div></a>
        <a href="https://www.instagram.com/radiomas104.9" target="_blank" rel="noopener"><div class="sm-btn sm-instagram"><i class="fab fa-instagram"></i></div></a>
        <a href="https://wa.me/5492964555666" target="_blank" rel="noopener"><div class="sm-btn sm-whatsapp"><i class="fab fa-whatsapp"></i></div></a>
        <a href="https://www.tiktok.com/@radiomas104.9" target="_blank" rel="noopener"><div class="sm-btn sm-tiktok"><i class="fab fa-tiktok"></i></div></a>
        <a href="https://www.youtube.com/@radiomas104.9" target="_blank" rel="noopener"><div class="sm-btn sm-youtube"><i class="fab fa-youtube"></i></div></a>
        <a href="https://x.com/radiomas1049" target="_blank" rel="noopener"><div class="sm-btn sm-x"><i class="fab fa-x-twitter"></i></div></a>
        <a href="indextv.html"><div class="sm-btn sm-tv"><i class="fa-solid fa-tv"></i></div></a>
        <a href="#" id="pwaInstallBtn"><div class="sm-btn sm-download"><i class="fa-solid fa-download"></i></div></a>
        <a href="prueba_mp3.html"><div class="sm-btn sm-tv"><i class="fa-solid fa-film"></i></div></a>
      </div>
    </div>

    <!-- Footer -->
    <p class="powered">
      <a href="#" target="_blank">RADIO + 104.9 DESDE 2025® – Tu Radio En Internet</a>
    </p>

    <pwa-install
      name="Instalar app oficial"
      description="Como si fuera una app real, pero más liviana"
      icon="logo.png"
      install-description="Agregala a tu dispositivo ahora"
      use-local-storage="true"
      manifest-url="manifest.json"
      disable-screenshots="true"
      style="--pwa-install-bg-color: black; --pwa-install-color: white;">
    </pwa-install>
  </main>

  <!-- Chat Widget -->
  <div id="chat-widget" aria-hidden="false" role="region" aria-label="Soporte - Chat bot">
    <div id="chat-header" role="toolbar" aria-label="Encabezado del chat">
      <div class="title">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        Soporte · Radio + 104.9
      </div>
      <div class="actions">
        <button id="clear-chat" title="Borrar mensajes" style="background:none;border:0;color:#cfcfcf;cursor:pointer;"><i class="fa-solid fa-trash"></i></button>
        <button id="close-chat" title="Minimizar chat" style="background:none;border:0;color:#cfcfcf;cursor:pointer;"><i class="fa-solid fa-chevron-down"></i></button>
      </div>
    </div>
    <div id="chat-messages" aria-live="polite" aria-atomic="false"></div>
    <div id="chat-quick"></div>
    <div id="chat-input">
      <input type="text" id="chat-text" placeholder="¿En qué te puedo ayudar? Ej: 'no se escucha'..." />
      <button id="chat-send"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>

  <button id="chat-toggle-btn"><i class="fa-solid fa-headset"></i></button>

  <!-- SCRIPTS -->
  <script>
    // ===== LUNARADIO =====
    $(document).ready(() => {
      $('#lunaradio').lunaradio({
        userinterface:'big',
        backgroundcolor:'rgba(0,0,0,0)',
        fontcolor:'#ffffff',
        hightlightcolor:'#ff0000',
        fontname:'Roboto',
        radioname:'Radio en vivo!',
        scroll:'true',
        coverimage:'logo.png',
        onlycoverimage:'true',
        coverstyle:'animated',
        usevisualizer:'real',
        visualizertype:'8',
        streamurl: 'http://212.84.160.3:5604/stream',
        streamtype:'shoutcast',
        shoutcastid:'1',
        metadatainterval:20000,
        volume:100
      });
    });


    // ===== CHAT BOT =====
    (function(){
      const SUPPORT_EMAIL='radiomas104.9@gmail.com', WHATSAPP_NUMBER='5492964555666', BOT_NAME='Soporte Radio + 104.9', STORAGE_KEY='radio_support_bot_v1', STATE_KEY='radio_chat_state_v1';
      const chatWidget=document.getElementById('chat-widget'), chatMessages=document.getElementById('chat-messages'), chatText=document.getElementById('chat-text'), chatSend=document.getElementById('chat-send');
      const clearBtn=document.getElementById('clear-chat'), closeBtn=document.getElementById('close-chat'), toggleBtn=document.getElementById('chat-toggle-btn'), quickBox=document.getElementById('chat-quick');
      let messages=[];
      
      const horaNow=()=>new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
      const escapeHtml=s=>String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      const linkify=t=>escapeHtml(t).replace(/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g,m=>`<a class="chat-link" href="mailto:${m}">${m}</a>`).replace(/(https?:\/\/[^\s]+)/g,m=>`<a class="chat-link" href="${m}" target="_blank" rel="noopener">${m}</a>`);

      const showTyping=()=>{ const el=document.createElement('div'); el.className='msg other typing'; el.id='typing-indicator'; el.innerHTML=`<div class="text">...</div><span class="meta">${BOT_NAME}</span>`; chatMessages.appendChild(el); chatMessages.scrollTop=chatMessages.scrollHeight; };
      const hideTyping=()=>{ const t=document.getElementById('typing-indicator'); if(t) t.remove(); };
      const saveMessages=()=>localStorage.setItem(STORAGE_KEY, JSON.stringify(messages));
      const loadMessages=()=>{ try{ messages=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')||[] } catch(e){ messages=[] } };
      const renderMessages=()=>{ chatMessages.innerHTML=''; messages.forEach(m=>{ const el=document.createElement('div'); el.className='msg '+(m.me?'me':'other'); el.innerHTML=`<div class="text">${linkify(m.text).replace(/\n/g,'<br>')}</div><span class="meta">${escapeHtml(m.name||BOT_NAME)} • ${m.time}</span>`; chatMessages.appendChild(el); }); chatMessages.scrollTop=chatMessages.scrollHeight; };
      const renderQuick=(options=[])=>{ quickBox.innerHTML=''; if(!options.length) options=["Cómo escucho","No se escucha","Instalar app","Quiero un gmail"]; options.forEach(q=>{ const btn=document.createElement('button'); btn.type='button'; btn.className='quick'; btn.textContent=q; btn.style='background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 8px;border-radius:8px;color:#fff;cursor:pointer;font-size:13px'; quickBox.appendChild(btn); }); };

      const intents=[
        {patterns:/hola|buen[oa]s|hol[ao]/i,responses:["¡Hola! Soy tu soporte de Radio + 104.9. ¿En qué puedo ayudarte?"], quick:["Cómo escucho","No se escucha","Instalar app","Quiero un gmail"]},
        {patterns:/escuch(ar|o)|stream|url|link/i,responses:["Podés escuchar desde el reproductor de la web. ¿Necesitás ayuda con el player?"], quick:["No se escucha","Recargar player"]},
        {patterns:/no se escucha|sin sonido|silencio|mute/i,responses:["Verificá volumen del player y del dispositivo. Si sigue sin sonido, probá otro navegador o recarga la página."], quick:["Probé todo","Enviar reporte"]},
        {patterns:/pwa|instal(ar|app)|descarg(ar|a)/i,responses:["Usá el botón de descarga en la web para instalar la app. ¿Querés una guía paso a paso?"], quick:["Guía instalación","No puedo instalar"]},
        {patterns:/humano|operador|atenc(ió|ion)/i,responses:[`Podés contactarnos por WhatsApp: https://wa.me/${WHATSAPP_NUMBER} o por correo: ${SUPPORT_EMAIL}`], quick:["Abrir WhatsApp","Enviar email","Quiero un gmail"]},
        {patterns:/horari(o|os)|programaci[oó]n/i,responses:["Transmisión 24/7. Consultá programación de programas específicos escribiendo su nombre."], quick:["Programación","DJ hoy"]},
        {patterns:/graci(as)?|genial|perfecto/i,responses:["¡De nada! ¿Necesitás algo más?"], quick:["Volver al inicio","Quiero un gmail"]}
      ];
      const fallbackResponses=["Disculpá, no entendí. Seleccioná una opción rápida o escribí 'hablar con humano' para asistencia."];
      const findIntent=text=>intents.find(i=>i.patterns.test(text))||null;

      const queueMessage=(text,me=true)=>{ if(!text?.trim()) return; const msg={id:'m_'+Date.now(),time:horaNow(),text:text.trim(),name:me?'Tú':BOT_NAME,me}; messages.push(msg); saveMessages(); renderMessages(); if(me) processBot(text); };

      const processBot=userText=>{
        setTimeout(showTyping,120);
        setTimeout(()=>{
          hideTyping();
          let intent=findIntent(userText), reply, quick;
          if(intent){ reply=typeof intent.responses[0]==='function'? intent.responses[0](userText) : intent.responses[0]; quick=intent.quick||[]; } 
          else { reply=fallbackResponses[0]; quick=["Hablar con humano","No se escucha","Instalar app"]; }

          if(userText.toLowerCase().includes('gmail')){
            reply=`El gmail de la radio es este: ${SUPPORT_EMAIL}\n(Hacé click para abrir tu cliente de correo)`;
            quick=["Abrir WhatsApp","Volver al inicio"];
          }

          const botMsg={id:'b_'+Date.now(), time:horaNow(), text:reply, name:BOT_NAME, me:false};
          messages.push(botMsg);
          saveMessages();
          renderMessages();
          renderQuick(quick);
        },700+Math.random()*700);
      };

      chatSend.addEventListener('click',()=>{ const t=chatText.value.trim(); if(!t) return; queueMessage(t,true); chatText.value=''; chatText.focus(); });
      chatText.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); chatSend.click(); } });
      clearBtn.addEventListener('click',()=>{ if(confirm('Borrar historial del chat?')){ messages=[]; saveMessages(); renderMessages(); } });
      closeBtn.addEventListener('click',()=>{ document.body.classList.remove('chat-open'); document.body.classList.add('chat-hidden'); localStorage.setItem(STATE_KEY, JSON.stringify({minimized:true})); });
      toggleBtn.addEventListener('click',()=>{ document.body.classList.remove('chat-hidden'); document.body.classList.add('chat-open'); localStorage.setItem(STATE_KEY, JSON.stringify({minimized:false})); setTimeout(()=>chatText.focus(),200); });
      quickBox.addEventListener('click', e=>{ const btn=e.target.closest('button'); if(!btn) return; queueMessage(btn.textContent,true); });

      loadMessages(); renderMessages(); renderQuick();
      if(!messages.length) setTimeout(()=>{ queueMessage("¡Hola! Soy tu asistente de soporte. ¿En qué te puedo ayudar?",false); renderQuick(); },500);
    })();
  </script>

  <script src="pwa.js"></script>
  <script src="main.js"></script>
  <script src="lock-site.js"></script>

</body>
</html>












